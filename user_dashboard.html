<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Dashboard</title>
<style>
/* your previous styling here */
</style>
</head>
<body>

<header>User Dashboard</header>
<div class="container">

  <div class="card" id="userDetails">
    <h3>User Details</h3>
    <p id="userInfo"></p>
    <p id="balance">Balance: â‚¦0</p>
    <button id="depositBtn" onclick="showDeposit()">ðŸ’³ Deposit</button>
  </div>

  <div class="card hidden" id="depositSection">
    <h3>Make a Payment</h3>
    <div class="account-box">
      <img src="imgs/Opay.png" alt="Bank Logo">
      <div class="account-info">
        <div>Account Name: Ralpheal Crayon Eigbefo</div>
        <div>Account No: 9126826953</div>
        <div>Bank: Opay</div>
      </div>
    </div>
    <input type="number" id="amount" placeholder="Enter amount">
    <input type="file" id="receipt">
    <button onclick="sendPayment()">Send Payment</button>
  </div>

  <div class="card">
    <h3>Transaction History</h3>
    <div id="historyBox"></div>
  </div>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCrWspENBK3NIdOL_3MYFARJjYEqGwyJBc",
  authDomain: "crk9villawalletdb.firebaseapp.com",
  projectId: "crk9villawalletdb",
  storageBucket: "crk9villawalletdb.firebasestorage.app",
  messagingSenderId: "1058331545188",
  appId: "1:1058331545188:web:c63da29d9981a6160f5971",
  measurementId: "G-BD3SXK2VB5"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let currentUser = JSON.parse(sessionStorage.getItem("currentUser"));

function loadUser() {
  db.collection("users").doc(currentUser.code).get().then(doc=>{
    if(!doc.exists) return;
    const user = doc.data();
    document.getElementById("userInfo").textContent = `${user.name} | Code: ${user.code} | Email: ${user.email}`;
    document.getElementById("balance").textContent = `Balance: â‚¦${user.balance}`;
    const box = document.getElementById("historyBox");
    box.innerHTML = "";
    user.history?.forEach(h=>{
      box.innerHTML += `<div class="log">${h.type.toUpperCase()} - â‚¦${h.amount} - ${h.date} - ${h.status || ""}</div>`;
    });
  });
}

function showDeposit() {
  document.getElementById("depositBtn").classList.add("hidden");
  document.getElementById("depositSection").classList.remove("hidden");
}

function sendPayment() {
  const amount = Number(document.getElementById("amount").value);
  const receiptFile = document.getElementById("receipt").files[0]?.name;

  if (!amount || amount <= 0) return alert("Enter a valid amount");
  if (!receiptFile) return alert("Attach receipt");

  db.collection("pendingDeposits").add({
    name: currentUser.name,
    code: currentUser.code,
    email: currentUser.email,
    amount,
    receipt: receiptFile,
    date: new Date().toLocaleString(),
    status:"pending"
  }).then(()=>{
    alert("âœ… Payment sent for admin approval");
    document.getElementById("amount").value="";
    document.getElementById("receipt").value="";
    document.getElementById("depositSection").classList.add("hidden");
    document.getElementById("depositBtn").classList.remove("hidden");
  });
}

loadUser();
setInterval(loadUser,2000);
</script>
</body>
</html>